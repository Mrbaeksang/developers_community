# 권한 매트릭스

## 전역 권한 (GlobalRole)

| 기능 | USER | MANAGER | ADMIN |
|------|------|---------|-------|
| **일반 기능** |
| 메인 게시글 작성 | ✅ | ✅ | ✅ |
| 메인 게시글 수정/삭제 | 본인만 | 본인만 + 하위 역할 작성 | 모두 |
| 댓글 작성 | ✅ | ✅ | ✅ |
| 댓글 수정/삭제 | 본인만 | 본인만 + 하위 역할 작성 | 모두 |
| 좋아요/북마크 | ✅ | ✅ | ✅ |
| **관리 기능** |
| 게시글 승인/거부 | ❌ | ✅ | ✅ |
| 태그 생성 | ❌ | ✅ | ✅ |
| 태그 수정 | ❌ | ✅ | ✅ |
| 태그 삭제 | ❌ | ❌ | ✅ |
| 전역 Ban 실행 | ❌ | ❌ | ✅ |
| 관리자 페이지 접근 | ❌ | ✅ | ✅ |
| 카테고리 관리 | ❌ | ❌ | ✅ |
| 사용자 역할 변경 | ❌ | ❌ | ✅ |

## 커뮤니티 권한 (CommunityRole)

| 기능 | MEMBER | MODERATOR | ADMIN | OWNER |
|------|--------|-----------|-------|-------|
| **일반 기능** |
| 게시글 작성 | ✅ | ✅ | ✅ | ✅ |
| 게시글 수정/삭제 | 본인만 | 본인만 + 하위 역할 작성 | 본인만 + 하위 역할 작성 | 모두 |
| 댓글 작성 | ✅ | ✅ | ✅ | ✅ |
| 댓글 수정/삭제 | 본인만 | 본인만 + 하위 역할 작성 | 본인만 + 하위 역할 작성 | 모두 |
| 좋아요/북마크 | ✅ | ✅ | ✅ | ✅ |
| 파일 업로드 | ✅ (허용 시) | ✅ (허용 시) | ✅ (허용 시) | ✅ |
| **관리 기능** |
| 멤버 Ban | ❌ | MEMBER만 | MEMBER, MODERATOR | 모두 (OWNER 제외) |
| 멤버 역할 변경 | ❌ | ❌ | MEMBER→MODERATOR | 모두 |
| 멤버 가입 승인 | ❌ | ❌ | ✅ | ✅ |
| 카테고리 생성/수정 | ❌ | ❌ | ✅ | ✅ |
| 공지사항 작성 | ❌ | ✅ | ✅ | ✅ |
| 공지사항 수정/삭제 | ❌ | 본인만 + MEMBER 작성 | 본인만 + 하위 역할 작성 | 모두 |
| 커뮤니티 설정 변경* | ❌ | ❌ | ✅ | ✅ |
| 커뮤니티 삭제 | ❌ | ❌ | ❌ | ✅ |
| 소유권 이전** | ❌ | ❌ | ❌ | ✅ |

*커뮤니티 설정: 이름, 설명, 규칙, 이미지, 공개여부(PUBLIC/PRIVATE), 파일업로드 허용, 채팅 허용, 파일크기 제한
**소유권 이전: ownerId 변경, 새 소유자가 OWNER 권한 획득, 이전 소유자는 MEMBER로 변경

## Ban 권한 상세

### 전역 Ban (User.isBanned)
- **실행 가능**: ADMIN만
- **대상**: 모든 사용자
- **효과**: 사이트 전체 접근 제한

### 커뮤니티 Ban (CommunityMember.status = BANNED)
- **실행 가능**: 
  - OWNER: 모든 멤버 Ban 가능
  - ADMIN: MODERATOR와 MEMBER Ban 가능
  - MODERATOR: MEMBER만 Ban 가능
- **효과**: 해당 커뮤니티만 접근 제한

## 중요 원칙

### 권한 계층 구조
1. **전역 권한 계층**: ADMIN > MANAGER > USER
2. **커뮤니티 권한 계층**: OWNER > ADMIN > MODERATOR > MEMBER
3. **상위 권한은 하위 권한의 모든 기능 포함**

### 콘텐츠 수정/삭제 원칙 (authorRole 기반)
1. **본인 작성 콘텐츠**: 역할에 관계없이 항상 수정/삭제 가능
2. **타인 작성 콘텐츠**: 
   - 작성자의 authorRole보다 높은 역할만 수정/삭제 가능
   - 예: MANAGER는 USER가 작성한 콘텐츠 수정 가능, 다른 MANAGER나 ADMIN이 작성한 콘텐츠는 불가
3. **authorRole 영구 보존**: 작성 시점의 역할을 기록하여 권한 변경 후에도 원 작성 권한 유지
4. **적용 대상**: 게시글, 댓글, 공지사항 등 모든 콘텐츠

### Ban 권한 원칙
1. **전역 Ban**: ADMIN만 실행 가능 (User.isBanned)
2. **커뮤니티 Ban**: 자신보다 낮은 역할만 Ban 가능
   - OWNER: ADMIN, MODERATOR, MEMBER Ban 가능
   - ADMIN: MODERATOR, MEMBER Ban 가능  
   - MODERATOR: MEMBER만 Ban 가능
3. **GlobalRole.ADMIN은 커뮤니티 Ban 면제**

### 특수 권한
1. **GlobalRole.ADMIN은 모든 커뮤니티에서 자동으로 CommunityRole.ADMIN 권한 보유**
2. **커뮤니티 소유권 관련 기능은 OWNER만 가능** (삭제, 소유권 이전)
3. **메인 사이트 게시글**: 
   - 작성 후 PENDING 상태 → MANAGER/ADMIN 승인 필요
   - ADMIN이 수정 시 상태 유지, 타 사용자 수정 시 다시 PENDING